lb:
  image: kontena/lb:latest
  ports:
    - 80:80
  #   - 443:80
  # secrets:
  #   - secret: HB_CERT
  #     name: SSL_CERTS
  #     type: env
  instances: 2
wp:
  build: "."
  image: mojdigital/hillsborough:latest
  stateful: true
  privileged: true
  instances: 2
  links:
    - lb
  environment:
    # - KONTENA_LB_MODE=http
    # - KONTENA_LB_BALANCE=source
    - KONTENA_LB_INTERNAL_PORT=80
    - KONTENA_LB_VIRTUAL_HOSTS=hillsborough.pub.dsd.io
    - WP_ENV=production
    - DISABLE_WP_CRON=true
    - SMTP_USE_STARTTLS=true
    - SMTP_USE_SSL=false
  secrets:
    - secret: HB_SERVER_NAME
      name: SERVER_NAME
      type: env
    - secret: HB_DB_USER
      name: DB_USER
      type: env
    - secret: HB_DB_PASSWORD
      name: DB_PASSWORD
      type: env
    - secret: HB_DB_NAME
      name: DB_NAME
      type: env
    - secret: HB_DB_HOST
      name: DB_HOST
      type: env
    - secret: HB_WP_HOME
      name: WP_HOME
      type: env
    - secret: HB_WP_SITEURL
      name: WP_SITEURL
      type: env
    - secret: AWS_ACCESS_KEY_ID
      name: AWS_ACCESS_KEY_ID
      type: env
    - secret: AWS_SECRET_ACCESS_KEY
      name: AWS_SECRET_ACCESS_KEY
      type: env
    - secret: HB_AWS_S3_BUCKET
      name: AWS_S3_BUCKET
      type: env
    - secret: HN_S3_UPLOADS_BASE_URL
      name: S3_UPLOADS_BASE_URL
      type: env
    - secret: HB_AUTH_KEY
      name: AUTH_KEY
      type: env
    - secret: HB_SECURE_AUTH_KEY
      name: SECURE_AUTH_KEY
      type: env
    - secret: HB_LOGGED_IN_KEY
      name: LOGGED_IN_KEY
      type: env
    - secret: HB_NONCE_KEY
      name: NONCE_KEY
      type: env
    - secret: HB_AUTH_SALT
      name: AUTH_SALT
      type: env
    - secret: HB_SECURE_AUTH_SALT
      name: SECURE_AUTH_SALT
      type: env
    - secret: HB_LOGGED_IN_SALT
      name: LOGGED_IN_SALT
      type: env
    - secret: HB_NONCE_SALT
      name: NONCE_SALT
      type: env
    - secret: HB_WHITELIST_IPS
      name: WHITELIST_IPS
      type: env
    - secret: HB_SMTP_HOST
      name: SMTP_HOST
      type: env
    - secret: HB_SMTP_PORT
      name: SMTP_PORT
      type: env
    - secret: HB_SMTP_USER
      name: SMTP_USER
      type: env
    - secret: HB_SMTP_PASS
      name: SMTP_PASS
      type: env
    - secret: HB_WHITELIST_IPS
      name: WHITELIST_IPS
      type: env
